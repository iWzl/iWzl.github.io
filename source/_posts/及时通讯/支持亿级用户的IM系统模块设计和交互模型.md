---
title: 支持亿级消息的IM系统模块设计和交互模型
date: 2021-03-23 10:04:23
tags:
	- 及时通讯
	- 系统架构
categories:
    - 及时通讯
abstract: 文章还在路上,敬请期待
---

# 支持亿级用户的IM系统模块设计和交互模型

​	现代实现的及时通讯系统一般由长连接和短连接配合使用进行实现，一般的实现架构即Connector和Service两个部分,分别对应长连接服务和短连接服务，**长连接服务主要用于服务端对客户端的推送和新消息到达的通知**，**短连接服务主要用于客户端对于消息的拉取和离线(在线)消息的同步**。当用户数据量增大时,其很容易就会出现以下的缺陷:

- **复杂性高**：每个模块服务包含的功能职责增多、模块的边界模糊、 依赖关系不清晰、 代码质量参差不齐、 混乱地堆砌在一起。
- **可靠性缺失**： 某个核心服务出现问题，例如死循环、内存溢出等， 可能会导致整个系统不能正常使用。
- **拓展成本增大**： 当用户体量增大时,部分服务功能会成为系统瓶颈,当进行服务扩容时,因为部分功能瓶颈的原因，就需要将整个服务进行拓展，带来不需要的成本开销。

为此就需要对常见IM系统架构进行更加细化的服务拆分,以下就IM服务功能拆分提供参考

<!-- more -->

## 技术指标

- **高可靠**：确保不丢消息；
- **高可用**：任意机房或者服务器挂掉，不影响服务；
- **实时性**：不管用户在哪里，在线用户消息在1秒内达到（我们实际是75%消息可以做到120ms）；
- **有序性**：确保用户消息的有序性，不会出现发送和接受的乱序。

## 架构拆分



