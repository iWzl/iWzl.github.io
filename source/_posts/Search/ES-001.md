---
title: ElasticSearch/Kibana/Logstash的搭建安装和部署
date: 2020-07-07 17:24:35
tags: 
	- ElasticSearch
categories:
	- Elastic
---

##  ElasticSearch的搭建安装和部署

### 文件目录结构

![项目文件结构](http://img.upuphub.com/image-20200920121905162-0575808.png)

* bin：脚本文件、包括启动ES、安装插件。运行数据统计等。
* condig：配置文件、USER、集群、Role Base的相关配置
* jdk.app：Java运行环境
* lib：Java类库
* logs：日志
* modules：包含所有的ES模块
* plugins：包含所有已安装的插件

启动：**➜  bin ./elasticsearch**

```shell
➜  bin ./elasticsearch
[2020-09-20T12:10:45,058][INFO ][o.e.n.Node               ] [LeoWangdeMacBook-Pro.local] version[7.9.1], pid[54756], build[default/tar/083627f112ba94dffc1232e8b42b73492789ef91/2020-09-01T21:22:21.964974Z], OS[Mac OS X/10.15.6/x86_64], JVM[AdoptOpenJDK/OpenJDK 64-Bit Server VM/14.0.1/14.0.1+7]
[2020-09-20T12:10:45,062][INFO ][o.e.n.Node               ] [LeoWangdeMacBook-Pro.local] JVM home [/Users/leo/Tools/elasticsearch-7.9.1/jdk.app/Contents/Home]
[2020-09-20T12:10:45,062][INFO ][o.e.n.Node               ] [LeoWangdeMacBook-Pro.local] JVM arguments [-Xshare:auto, -Des.networkaddress.cache.ttl=60, -Des.networkaddress.cache.negative.ttl=10, -XX:+AlwaysPreTouch, -Xss1m, -Djava.awt.headless=true, -Dfile.encoding=UTF-8, -Djna.nosys=true, -XX:-OmitStackTraceInFastThrow, -XX:+ShowCodeDetailsInExceptionMessages, -Dio.netty.noUnsafe=true, -Dio.netty.noKeySetOptimization=true, -Dio.netty.recycler.maxCapacityPerThread=0, -Dio.netty.allocator.numDirectArenas=0, -Dlog4j.shutdownHookEnabled=false, -Dlog4j2.disable.jmx=true, -Djava.locale.providers=SPI,COMPAT, -Xms1g, -Xmx1g, -XX:+UseG1GC, -XX:G1ReservePercent=25, -XX:InitiatingHeapOccupancyPercent=30, -Djava.io.tmpdir=/var/folders/pr/1s6y6x8s4_798www9hyr0p0m0000gn/T/elasticsearch-12523685105788999697, -XX:+HeapDumpOnOutOfMemoryError, -XX:HeapDumpPath=data, -XX:ErrorFile=logs/hs_err_pid%p.log, -Xlog:gc*,gc+age=trace,safepoint:file=logs/gc.log:utctime,pid,tags:filecount=32,filesize=64m, -XX:MaxDirectMemorySize=536870912, -Des.path.home=/Users/leo/Tools/elasticsearch-7.9.1, -Des.path.conf=/Users/leo/Tools/elasticsearch-7.9.1/config, -Des.distribution.flavor=default, -Des.distribution.type=tar, -Des.bundled_jdk=true]
[2020-09-20T12:10:46,910][INFO ][o.e.p.PluginsService     ] [LeoWangdeMacBook-Pro.local] loaded module [aggs-matrix-stats]
[2020-09-20T12:10:46,911][INFO ][o.e.p.PluginsService     ] [LeoWangdeMacBook-Pro.local] loaded module [analysis-common]
[2020-09-20T12:10:46,911][INFO ][o.e.p.PluginsService     ] [LeoWangdeMacBook-Pro.local] loaded module [constant-keyword]
[2020-09-20T12:10:46,911][INFO ][o.e.p.PluginsService     ] [LeoWangdeMacBook-Pro.local] loaded module [flattened]
[2020-09-20T12:10:46,912][INFO ][o.e.p.PluginsService     ] [LeoWangdeMacBook-Pro.local] loaded module [frozen-indices]
[2020-09-20T12:10:46,912][INFO ][o.e.p.PluginsService     ] [LeoWangdeMacBook-Pro.local] loaded module [ingest-common]
[2020-09-20T12:10:46,912][INFO ][o.e.p.PluginsService     ] [LeoWangdeMacBook-Pro.local] loaded module [ingest-geoip]
[2020-09-20T12:10:46,912][INFO ][o.e.p.PluginsService     ] [LeoWangdeMacBook-Pro.local] loaded module [ingest-user-agent]
[2020-09-20T12:10:46,912][INFO ][o.e.p.PluginsService     ] [LeoWangdeMacBook-Pro.local] loaded module [kibana]
[2020-09-20T12:10:46,913][INFO ][o.e.p.PluginsService     ] [LeoWangdeMacBook-Pro.local] loaded module [lang-expression]
[2020-09-20T12:10:46,913][INFO ][o.e.p.PluginsService     ] [LeoWangdeMacBook-Pro.local] loaded module [lang-mustache]
[2020-09-20T12:10:46,913][INFO ][o.e.p.PluginsService     ] [LeoWangdeMacBook-Pro.local] loaded module [lang-painless]
[2020-09-20T12:10:46,913][INFO ][o.e.p.PluginsService     ] [LeoWangdeMacBook-Pro.local] loaded module [mapper-extras]
[2020-09-20T12:10:46,913][INFO ][o.e.p.PluginsService     ] [LeoWangdeMacBook-Pro.local] loaded module [parent-join]
[2020-09-20T12:10:46,913][INFO ][o.e.p.PluginsService     ] [LeoWangdeMacBook-Pro.local] loaded module [percolator]
[2020-09-20T12:10:46,914][INFO ][o.e.p.PluginsService     ] [LeoWangdeMacBook-Pro.local] loaded module [rank-eval]
[2020-09-20T12:10:46,914][INFO ][o.e.p.PluginsService     ] [LeoWangdeMacBook-Pro.local] loaded module [reindex]
[2020-09-20T12:10:46,914][INFO ][o.e.p.PluginsService     ] [LeoWangdeMacBook-Pro.local] loaded module [repository-url]
[2020-09-20T12:10:46,914][INFO ][o.e.p.PluginsService     ] [LeoWangdeMacBook-Pro.local] loaded module [search-business-rules]
[2020-09-20T12:10:46,915][INFO ][o.e.p.PluginsService     ] [LeoWangdeMacBook-Pro.local] loaded module [searchable-snapshots]
[2020-09-20T12:10:46,915][INFO ][o.e.p.PluginsService     ] [LeoWangdeMacBook-Pro.local] loaded module [spatial]
[2020-09-20T12:10:46,915][INFO ][o.e.p.PluginsService     ] [LeoWangdeMacBook-Pro.local] loaded module [tasks]
[2020-09-20T12:10:46,915][INFO ][o.e.p.PluginsService     ] [LeoWangdeMacBook-Pro.local] loaded module [transform]
[2020-09-20T12:10:46,915][INFO ][o.e.p.PluginsService     ] [LeoWangdeMacBook-Pro.local] loaded module [transport-netty4]
[2020-09-20T12:10:46,916][INFO ][o.e.p.PluginsService     ] [LeoWangdeMacBook-Pro.local] loaded module [vectors]
[2020-09-20T12:10:46,916][INFO ][o.e.p.PluginsService     ] [LeoWangdeMacBook-Pro.local] loaded module [wildcard]
[2020-09-20T12:10:46,916][INFO ][o.e.p.PluginsService     ] [LeoWangdeMacBook-Pro.local] loaded module [x-pack-analytics]
[2020-09-20T12:10:46,916][INFO ][o.e.p.PluginsService     ] [LeoWangdeMacBook-Pro.local] loaded module [x-pack-async]
[2020-09-20T12:10:46,916][INFO ][o.e.p.PluginsService     ] [LeoWangdeMacBook-Pro.local] loaded module [x-pack-async-search]
[2020-09-20T12:10:46,916][INFO ][o.e.p.PluginsService     ] [LeoWangdeMacBook-Pro.local] loaded module [x-pack-autoscaling]
[2020-09-20T12:10:46,917][INFO ][o.e.p.PluginsService     ] [LeoWangdeMacBook-Pro.local] loaded module [x-pack-ccr]
[2020-09-20T12:10:46,917][INFO ][o.e.p.PluginsService     ] [LeoWangdeMacBook-Pro.local] loaded module [x-pack-core]
[2020-09-20T12:10:46,917][INFO ][o.e.p.PluginsService     ] [LeoWangdeMacBook-Pro.local] loaded module [x-pack-data-streams]
[2020-09-20T12:10:46,917][INFO ][o.e.p.PluginsService     ] [LeoWangdeMacBook-Pro.local] loaded module [x-pack-deprecation]
[2020-09-20T12:10:46,917][INFO ][o.e.p.PluginsService     ] [LeoWangdeMacBook-Pro.local] loaded module [x-pack-enrich]
[2020-09-20T12:10:46,917][INFO ][o.e.p.PluginsService     ] [LeoWangdeMacBook-Pro.local] loaded module [x-pack-eql]
[2020-09-20T12:10:46,918][INFO ][o.e.p.PluginsService     ] [LeoWangdeMacBook-Pro.local] loaded module [x-pack-graph]
[2020-09-20T12:10:46,918][INFO ][o.e.p.PluginsService     ] [LeoWangdeMacBook-Pro.local] loaded module [x-pack-identity-provider]
[2020-09-20T12:10:46,918][INFO ][o.e.p.PluginsService     ] [LeoWangdeMacBook-Pro.local] loaded module [x-pack-ilm]
[2020-09-20T12:10:46,918][INFO ][o.e.p.PluginsService     ] [LeoWangdeMacBook-Pro.local] loaded module [x-pack-logstash]
[2020-09-20T12:10:46,918][INFO ][o.e.p.PluginsService     ] [LeoWangdeMacBook-Pro.local] loaded module [x-pack-ml]
[2020-09-20T12:10:46,919][INFO ][o.e.p.PluginsService     ] [LeoWangdeMacBook-Pro.local] loaded module [x-pack-monitoring]
[2020-09-20T12:10:46,919][INFO ][o.e.p.PluginsService     ] [LeoWangdeMacBook-Pro.local] loaded module [x-pack-ql]
[2020-09-20T12:10:46,919][INFO ][o.e.p.PluginsService     ] [LeoWangdeMacBook-Pro.local] loaded module [x-pack-rollup]
[2020-09-20T12:10:46,919][INFO ][o.e.p.PluginsService     ] [LeoWangdeMacBook-Pro.local] loaded module [x-pack-security]
[2020-09-20T12:10:46,919][INFO ][o.e.p.PluginsService     ] [LeoWangdeMacBook-Pro.local] loaded module [x-pack-sql]
[2020-09-20T12:10:46,919][INFO ][o.e.p.PluginsService     ] [LeoWangdeMacBook-Pro.local] loaded module [x-pack-stack]
[2020-09-20T12:10:46,919][INFO ][o.e.p.PluginsService     ] [LeoWangdeMacBook-Pro.local] loaded module [x-pack-voting-only-node]
[2020-09-20T12:10:46,920][INFO ][o.e.p.PluginsService     ] [LeoWangdeMacBook-Pro.local] loaded module [x-pack-watcher]
[2020-09-20T12:10:46,920][INFO ][o.e.p.PluginsService     ] [LeoWangdeMacBook-Pro.local] loaded plugin [analysis-icu]
[2020-09-20T12:10:46,960][INFO ][o.e.e.NodeEnvironment    ] [LeoWangdeMacBook-Pro.local] using [1] data paths, mounts [[/System/Volumes/Data (/dev/disk1s1)]], net usable_space [149.5gb], net total_space [233.4gb], types [apfs]
[2020-09-20T12:10:46,960][INFO ][o.e.e.NodeEnvironment    ] [LeoWangdeMacBook-Pro.local] heap size [1gb], compressed ordinary object pointers [true]
[2020-09-20T12:10:47,060][INFO ][o.e.n.Node               ] [LeoWangdeMacBook-Pro.local] node name [LeoWangdeMacBook-Pro.local], node ID [YxIXbsumQAeVzuxPgWwQvA], cluster name [elasticsearch]
[2020-09-20T12:10:50,165][INFO ][o.e.x.m.p.l.CppLogMessageHandler] [LeoWangdeMacBook-Pro.local] [controller/54798] [Main.cc@114] controller (64 bit): Version 7.9.1 (Build 6ed2566ba11bb5) Copyright (c) 2020 Elasticsearch BV
[2020-09-20T12:10:50,997][INFO ][o.e.x.s.a.s.FileRolesStore] [LeoWangdeMacBook-Pro.local] parsed [0] roles from file [/Users/leo/Tools/elasticsearch-7.9.1/config/roles.yml]
[2020-09-20T12:10:51,861][INFO ][o.e.d.DiscoveryModule    ] [LeoWangdeMacBook-Pro.local] using discovery type [zen] and seed hosts providers [settings]
[2020-09-20T12:10:52,299][WARN ][o.e.g.DanglingIndicesState] [LeoWangdeMacBook-Pro.local] gateway.auto_import_dangling_indices is disabled, dangling indices will not be automatically detected or imported and must be managed manually
[2020-09-20T12:10:52,630][INFO ][o.e.n.Node               ] [LeoWangdeMacBook-Pro.local] initialized
[2020-09-20T12:10:52,630][INFO ][o.e.n.Node               ] [LeoWangdeMacBook-Pro.local] starting ...
[2020-09-20T12:10:57,772][INFO ][o.e.t.TransportService   ] [LeoWangdeMacBook-Pro.local] publish_address {127.0.0.1:9300}, bound_addresses {[::1]:9300}, {127.0.0.1:9300}
[2020-09-20T12:10:58,048][WARN ][o.e.b.BootstrapChecks    ] [LeoWangdeMacBook-Pro.local] the default discovery settings are unsuitable for production use; at least one of [discovery.seed_hosts, discovery.seed_providers, cluster.initial_master_nodes] must be configured
[2020-09-20T12:10:58,049][INFO ][o.e.c.c.Coordinator      ] [LeoWangdeMacBook-Pro.local] cluster UUID [QcR_jXXaRB6DKSkYv_IDcQ]
[2020-09-20T12:10:58,056][INFO ][o.e.c.c.ClusterBootstrapService] [LeoWangdeMacBook-Pro.local] no discovery configuration found, will perform best-effort cluster bootstrapping after [3s] unless existing master is discovered
[2020-09-20T12:10:58,155][INFO ][o.e.c.s.MasterService    ] [LeoWangdeMacBook-Pro.local] elected-as-master ([1] nodes joined)[{LeoWangdeMacBook-Pro.local}{YxIXbsumQAeVzuxPgWwQvA}{1VVNmpljRGGTot4vIl_h5Q}{127.0.0.1}{127.0.0.1:9300}{dilmrt}{ml.machine_memory=17179869184, xpack.installed=true, transform.node=true, ml.max_open_jobs=20} elect leader, _BECOME_MASTER_TASK_, _FINISH_ELECTION_], term: 2, version: 36, delta: master node changed {previous [], current [{LeoWangdeMacBook-Pro.local}{YxIXbsumQAeVzuxPgWwQvA}{1VVNmpljRGGTot4vIl_h5Q}{127.0.0.1}{127.0.0.1:9300}{dilmrt}{ml.machine_memory=17179869184, xpack.installed=true, transform.node=true, ml.max_open_jobs=20}]}
[2020-09-20T12:10:58,219][INFO ][o.e.c.s.ClusterApplierService] [LeoWangdeMacBook-Pro.local] master node changed {previous [], current [{LeoWangdeMacBook-Pro.local}{YxIXbsumQAeVzuxPgWwQvA}{1VVNmpljRGGTot4vIl_h5Q}{127.0.0.1}{127.0.0.1:9300}{dilmrt}{ml.machine_memory=17179869184, xpack.installed=true, transform.node=true, ml.max_open_jobs=20}]}, term: 2, version: 36, reason: Publication{term=2, version=36}
[2020-09-20T12:10:58,253][INFO ][o.e.h.AbstractHttpServerTransport] [LeoWangdeMacBook-Pro.local] publish_address {127.0.0.1:9200}, bound_addresses {[::1]:9200}, {127.0.0.1:9200}
[2020-09-20T12:10:58,254][INFO ][o.e.n.Node               ] [LeoWangdeMacBook-Pro.local] started
[2020-09-20T12:10:58,408][INFO ][o.e.l.LicenseService     ] [LeoWangdeMacBook-Pro.local] license [322a2d29-7ef9-439a-99f5-69074647e8ab] mode [basic] - valid
[2020-09-20T12:10:58,410][INFO ][o.e.x.s.s.SecurityStatusChangeListener] [LeoWangdeMacBook-Pro.local] Active license is now [BASIC]; Security is disabled
[2020-09-20T12:10:58,416][INFO ][o.e.g.GatewayService     ] [LeoWangdeMacBook-Pro.local] recovered [0] indices into cluster_state

```

➜ 访问：http://localhost:9200/

![安装部署成功](http://img.upuphub.com/image-20200920122055780-0575998.png)

### 插件安装

```SHELL
➜  bin ./elasticsearch-plugin list
➜  bin ./elasticsearch-plugin install analysis-icu
-> Installing analysis-icu
-> Downloading analysis-icu from elastic
[=================================================] 100%
-> Installed analysis-icu
➜  bin ./elasticsearch-plugin list
analysis-icu
```

![插件安装](http://img.upuphub.com/image-20200920121717443.png)

## Kibana的搭建安装和部署

